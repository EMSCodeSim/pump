<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FireOpsCalc</title>
    <meta
      name="description"
      content="FireOpsCalc.com — Firefighter pump, hydrant, and tender shuttle calculator. Built for phone use."
    />
    <link rel="icon" href="/fireopscalc.png" />
    <meta name="theme-color" content="#0a0f1f" />

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6W3WSFVFGW"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-6W3WSFVFGW");
    </script>

    <style>
      body {
        margin: 0;
        font-family: system-ui, sans-serif;
        background: #0b1020;
        color: #e5e7eb;
      }
      header {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 15px;
        background: #111827;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      }
      header img {
        width: 36px;
        height: 36px;
      }
      header h1 {
        font-size: 1.1rem;
        margin: 0;
      }
      main {
        max-width: 900px;
        margin: 0 auto;
        padding: 15px;
      }
      .card {
        background: #141a2f;
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 15px;
      }
      .row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
        margin-bottom: 10px;
      }
      input,
      select,
      button {
        flex: 1;
        font-size: 1rem;
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid #1f2937;
        background: #0e1426;
        color: #e5e7eb;
      }
      button {
        cursor: pointer;
      }
      .kpi {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 10px;
      }
      .bubble {
        background: #0e1426;
        border: 1px solid #1f2937;
        border-radius: 10px;
        padding: 10px;
        min-width: 120px;
      }
      .bubble .label {
        font-size: 12px;
        color: #9ca3af;
      }
      .bubble .value {
        font-weight: 700;
        font-size: 18px;
      }
      nav {
        position: sticky;
        bottom: 0;
        background: #0e1426;
        display: flex;
        border-top: 1px solid rgba(255, 255, 255, 0.08);
      }
      nav button {
        flex: 1;
        border: none;
        background: none;
        padding: 12px;
        color: #e5e7eb;
      }
      nav button.active {
        color: #38bdf8;
        font-weight: bold;
      }
    </style>
  </head>

  <body>
    <header>
      <img src="/fireopscalc.png" alt="FireOpsCalc logo" />
      <h1>FireOpsCalc.com</h1>
    </header>

    <main>
      <section id="calc" class="card">
        <h2>Line Calculations</h2>
        <div class="kpi">
          <div class="bubble">
            <div class="label">Total Flow</div>
            <div class="value" id="totalFlow">0 gpm</div>
          </div>
          <div class="bubble">
            <div class="label">Max PDP</div>
            <div class="value" id="maxPDP">0 psi</div>
          </div>
        </div>

        <div class="row">
          <select id="preset1">
            <option value="">Preset 1</option>
            <option value="150@75">1¾” Fog 150 @ 75</option>
            <option value="160@50">1¾” Smooth 160 @ 50</option>
            <option value="200@50">2½” Smooth 200 @ 50</option>
          </select>
          <input id="len1" type="number" placeholder="Length (ft)" />
        </div>

        <div class="row">
          <select id="preset2">
            <option value="">Preset 2</option>
            <option value="150@75">1¾” Fog 150 @ 75</option>
            <option value="160@50">1¾” Smooth 160 @ 50</option>
            <option value="200@50">2½” Smooth 200 @ 50</option>
          </select>
          <input id="len2" type="number" placeholder="Length (ft)" />
        </div>

        <div class="row">
          <button id="addLine">Add Line</button>
          <button id="resetLines">Reset Lines</button>
        </div>
      </section>

      <section id="water" class="card">
        <h2>Water Supply</h2>
        <div class="row">
          <select id="source">
            <option value="hydrant">Hydrant</option>
            <option value="static">Static</option>
            <option value="shuttle">Tender Shuttle</option>
          </select>
          <input id="static" type="number" placeholder="Static (psi)" />
          <input id="residual" type="number" placeholder="Residual (psi)" />
        </div>

        <div class="row">
          <button id="calcDrop">Calc % Drop</button>
          <input id="dropResult" readonly placeholder="%" />
        </div>

        <div class="row">
          <label>Tenders</label>
          <input id="tenderCount" type="number" placeholder="Count" />
          <label>Capacity (gal)</label>
          <input id="tenderCap" type="number" placeholder="3000" />
        </div>

        <div class="row">
          <button id="startTrip">Start</button>
          <button id="stopTrip">Stop</button>
          <input id="tripSecs" readonly placeholder="Seconds" />
        </div>

        <div class="row">
          <button id="calcShuttle">Calc Shuttle GPM</button>
          <input id="shuttleGPM" readonly placeholder="GPM" />
        </div>
      </section>
    </main>

    <nav>
      <button class="active" data-view="calc">Calculations</button>
      <button data-view="water">Water Supply</button>
    </nav>

    <!-- Reset hose-line state on every load BEFORE the app boots -->
    <script>
      (function () {
        const keys = ["hoselines", "lineState", "calcState", "calc_lines", "calc_presets"];
        try {
          keys.forEach((k) => {
            localStorage.removeItem(k);
            sessionStorage.removeItem(k);
          });
        } catch (e) {}
        window.FIREOPSCALC_RESET_ON_LOAD = true;
        window.addEventListener("pageshow", function (ev) {
          if (ev.persisted) {
            try {
              keys.forEach((k) => {
                localStorage.removeItem(k);
                sessionStorage.removeItem(k);
              });
            } catch (e) {}
            window.FIREOPSCALC_RESET_ON_LOAD = true;
          }
        });
      })();
    </script>

    <script type="module" src="/js/app.js"></script>
  </body>
</html>
